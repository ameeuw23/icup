{% extends "ICupPublicSiteBundle:Masters:standard.html.twig" %}
{% trans_default_domain "tournament" %}

{% import _self as formatter %}

{% macro club(team, group, tag, context) %}
            <tr>
    {% if team.id > 0 %}
                <td class="flag">
                    <img src="{{ context.imagepath }}/flags/{{ context.countries[team.country].flag }}"
                         alt="{{ team.country|trans({},'lang') }}"
                         title="{{ team.country|trans({},'lang') }}">
                </td>
                <td class="team{{ tag }}">
    {% if team.rank != '' %}
                    <div class="rank">{{ team.rank }}</div>
    {% endif %}
                    <a href="{{ path('_showteam', { 'teamid': team.id,
                                                    'groupid': group.id }) }}">{{ team.name }}</a>
                </td>
                <td class="score{{ tag }}">{{ team.score }}</td>
    {% else %}
                <td class="flag"></td>
                <td class="team">{{ team.rank }}</td>
                <td class="score"></td>
    {% endif %}
            </tr>
{% endmacro %}

{% macro match(match, context) %}
        <table>
            {{ context.formatter.club(match.home, match.group, match.home.score > match.away.score ? ' winner' : '', context) }}
            <tr>
                <td class="flag"></td>
                <td class="team">
                    <div class="rank">
                        {% trans %}LEGEND.NO{% endtrans %}: {{ match.matchno }} - 
                        {{ ['GROUPCLASS.',match.group.classification]|join|trans([],'tournament') }}
{% if match.group.classification == 8 %}
                        {{ match.group.name }}
{% endif %}                        
                        <br/>
                        {{ 'FORMAT.LONGDATE'|transchoice(match.schedule|date('j'), {
                            '%week%': ['WEEK.',match.schedule|date('D')|upper]|join|trans([],'messages')|capitalize,
                            '%day%': match.schedule|date('j'),
                            '%month%': ['MONTH.',match.schedule|date('M')|upper]|join|trans([],'messages'),
                            '%year%': match.schedule|date('Y')}, 'messages') }}<br/>
                        {% trans %}LEGEND.TIME{% endtrans %}: {{ match.schedule|date('FORMAT.TIME'|trans([],'messages')) }}
                    </div>
                </td>
                <td class="score"></td>
            </tr>
            {{ context.formatter.club(match.away, match.group, match.away.score > match.home.score ? ' winner' : '', context) }}
        </table>
{% endmacro %}
        
{% block body %}
<h1 class="category">{{ tournament.name }}</h1>
<p class="subcategory">
    {% trans %}RESULTS{% endtrans %} {{ tournament.edition }}<br />
</p>
<a href="{{ path('_tournament_categories', {'tournament': tournament.key }) }}">
    <h1 class="category">{% trans %}CATEGORY{% endtrans %} {{ category.name }}</h1>
</a>
<p class="subcategory">
    {{ ['GENDER.',
        category.gender,
        category.classification]|join|transchoice(category.age, { '%age%': category.age },'tournament') }}
</p>
<div class="tab" onclick="location.href='{{ path('_showcategory', { 'categoryid': category.id }) }}'">{{ 'PRELIMINARY'|trans|upper }}</div>
{% if classifications > 0 %}
<div class="tab" onclick="location.href='{{ path('_showcategory_classification', { 'categoryid': category.id }) }}'">{{ 'CLASSIFICATION'|trans|upper }}</div>
{% endif %}
<div class="tab active" onclick="location.href='{{ path('_showcategory_finals', { 'categoryid': category.id }) }}'">{{ 'FINALS'|trans|upper }}</div>
{% if champions|length > 0 %}
<table>
    <caption>{% trans %}STANDING{% endtrans %}</caption>
    {% if not 'S' in champions|keys %}
    <thead>
        <tr><td>{{ 'FINALS'|trans|upper }}</td></tr>
    </thead>
    <tbody>
        <tr><td class="spacer"></td></tr>
    {% if 'F' in champions|keys %}
        <tr><td rowspan="2" class="finals">
                {{ formatter.match(champions.F[0], _context) }}
            </td>
        </tr>
        <tr><td></td></tr>
    {% endif %}
    {% if 'B' in champions|keys %}
        <tr><td class="spacer">{% trans %}BRONZEMATCH{% endtrans %}</td></tr>
         <tr><td rowspan="2" class="finals">
                {{ formatter.match(champions.B[0], _context) }}
            </td>
        </tr>
        <tr><td></td></tr>
    {% endif %}
    </tbody>
    {% else %}
    <thead>
        <tr><td>{{ 'SEMIFINALS'|trans|upper }}</td><td colspan="2"></td><td>{{ 'FINALS'|trans|upper }}</td></tr>
    </thead>
    <tbody>
        <tr><td/><td/><td/><td class="spacer"></td></tr>
    {% if 'S' in champions|keys %}
        <tr><td rowspan="2" class="finals">
                {{ formatter.match(champions.S[0], _context) }}
            </td><td class="filler"></td><td/><td/></td>
        </tr>
        <tr><td class="lineED"></td><td/><td/></tr>
    {% endif %}
    {% if 'F' in champions|keys %}
        <tr><td/><td/><td class="lineSD filler"></td><td rowspan="2" class="finals">
                {{ formatter.match(champions.F[0], _context) }}
            </td>
        </tr>
        <tr><td/><td/><td class="lineSU"></td></tr>
    {% endif %}
    {% if 'S' in champions|keys %}
        <tr><td rowspan="2" class="finals">
                {{ formatter.match(champions.S[1], _context) }}
            </td><td class="lineEU filler"></td><td/><td/>
        </tr>
        <tr><td/><td/><td/></tr>
    {% endif %}
    {% if 'B' in champions|keys %}
        <tr><td/><td/><td/><td class="spacer">{% trans %}BRONZEMATCH{% endtrans %}</td></tr>
        <tr><td/><td/><td/><td rowspan="2" class="finals">
                {{ formatter.match(champions.B[0], _context) }}
            </td>
        </tr>
        <tr><td/><td/><td/></tr>
    {% endif %}
    </tbody>
    {% endif %}
</table>
{% else %}
<h2 class="category">{% trans %}TOURNAMENTNOTREADY{% endtrans %}</h2>
{% endif %}
{% endblock %}