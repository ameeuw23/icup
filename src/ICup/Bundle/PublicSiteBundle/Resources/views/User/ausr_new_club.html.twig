{% extends "ICupPublicSiteBundle:Masters:standard.html.twig" %}

{% form_theme form 'ICupPublicSiteBundle:Default:layout.script.html.twig' %}
{% trans_default_domain "club" %}

{% block body %}
    <div style="width: 70%; float: left;">
{% if tournament is defined and tournament %}
    <h1>{{ tournament.name }}</h1>
    <p class="lead">{% trans %}FORM.TITLE{% endtrans %}</p>
{% else %}
    <h1>{% trans %}FORM.TITLE{% endtrans %}</h1>
{% endif %}
    <p>{% trans %}FORM.LOGIN.TITLE{% endtrans %}</p>
    {{ form(form) }}
    </div>
    <div class="searchresult" style="width: 25%; float: left;">
        <table width="100%">
            <caption>{% trans %}FORM.NEWCLUB.CAPTION{% endtrans %}</caption>
            <thead>
                <tr><td>{% trans %}FORM.NEWCLUB.LEGEND{% endtrans %}</td></tr>
            </thead>
            <tbody id="form_div">
                <tr><td>{% trans %}FORM.NEWCLUB.NOCLUBS{% endtrans %}</td></tr>    
            </tbody>
            <tfoot>
                <tr><td></td></tr>
            </tfoot>
        </table>
        <div class="searchresult_info">{% trans %}FORM.NEWCLUB.INFO{% endtrans %}</div>
    </div>
{% endblock %}

{% block javascripts %}
    <script type="text/javascript">
        $(function onLoad() {
            $('input#form_name').keyup(OnKeyUp);
            $('select#form_country').change(OnKeyUp);
        });
        function OnKeyUp() {
                $.getJSON(Routing.generate('_rest_list_clubs',
                                            {
                                                'countrycode': $('select#form_country').val(),
                                                'pattern': '%'+$('input#form_name').val()+'%'
                                            }),
                           function readClubs(data, status) {
                               if (data.length > 0) {
                                    $('#form_div').html(buildTable(data));
                                }
                                else {
                                    $('#form_div').html(buildDefault());
                                }
                           }
                         );
        };
        function buildTable(data) {
           opt = '';
           $.each(data, 
                   function updateDropDown(index, club) {
                       if (index < 3) {
                         opt += "<tr><td>";
                         opt += "<span class='link' onclick='location.href=\"{{ path('_club_user_request') }}?clubid="+club.id+"\"'>"+club.name+"</span>";
                         opt += "</td></tr>";
                       }
                   });
           if (data.length > 3) {
               opt += "<tr><td>{% trans %}FORM.NEWCLUB.MORECLUBS{% endtrans %}</td></tr>";
           }
           return opt;
        };
        function buildDefault() {
           opt = "<tr><td>{% trans %}FORM.NEWCLUB.NOCLUBS{% endtrans %}</td></tr>";
           return opt;
        };
    </script>
{% endblock %}
